(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-3",headers:{authorization:"10b8028b-2a3b-4f48-a971-8c381370f2f5","Content-Type":"application/json"}},e=document.getElementById("card-template").content;function n(t,n,o,r,c){var a=e.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__delete-button"),s=a.querySelector(".card__title"),l=a.querySelector(".card__like-button"),d=a.querySelector(".card-like-count");return a.dataset.cardId=t._id,s.textContent=t.name,i.src=t.link,i.alt=t.name,n===t.owner._id?u.addEventListener("click",(function(t){return r(a)})):u.remove(),l.addEventListener("click",(function(e){c(e,t._id)})),d.textContent=t.likes.length,t.likes.forEach((function(t){n===t._id&&l.classList.add("card__like-button_is-active")})),i.addEventListener("click",o),a}function o(e){var n;n=e.dataset.cardId,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то не так: ".concat(t.status))})).catch((function(t){console.log(t)})),e.remove()}function r(e,n){var o=e.target.parentNode.querySelector(".card-like-count");e.target.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то не так: ".concat(t.status))})).catch((function(t){console.log(t)}))}(n).then((function(t){o.textContent=t.likes.length,e.target.classList.remove("card__like-button_is-active")})).catch((function(t){console.log(t)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то не так: ".concat(t.status))})).catch((function(t){console.log(t)}))}(n).then((function(t){o.textContent=t.likes.length,e.target.classList.add("card__like-button_is-active")})).catch((function(t){console.log(t)}))}function c(t){t.classList.add("popup_is-opened"),t.classList.add("popup_is-animated"),document.addEventListener("keydown",i)}function a(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(t){"Escape"===t.key&&a(document.querySelector(".popup_is-opened"))}function u(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function s(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function l(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),n.forEach((function(n){u(t,n,e),n.setCustomValidity("")}))}function d(t,e){e.textContent=t?"Сохранение...":"Сохранить"}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",(function(e){t.target===t.currentTarget&&a(e.target),function(t){t.target.classList.contains("popup__close")&&a(t.target.closest(".popup_is-opened"))}(e)}))}));var f=document.querySelector(".places__list");Promise.all([fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то не так: ".concat(t.status))})).catch((function(t){console.log(t)})),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то не так: ".concat(t.status))})).catch((function(t){console.log(t)}))]).then((function(t){var e,c,a=(c=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){s=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return i}}(e,c)||function(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(e,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1],s=u._id;i.forEach((function(t){var e=n(t,s,w,o,r);f.append(e)})),document.querySelector(".profile__title").textContent=u.name,document.querySelector(".profile__description").textContent=u.about,document.querySelector(".profile__image").src=u.avatar})).catch((function(t){console.log(t)}));var m=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup__input_type_name"),v=document.querySelector(".popup__input_type_description"),h=document.forms["edit-profile"],S=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),g=h.querySelector(".button");m.addEventListener("click",(function(){c(_),y.value=S.textContent,v.value=b.textContent,l(h,U)})),h.addEventListener("submit",(function(e){e.preventDefault(),d(!0,g),function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то не так: ".concat(t.status))})).catch((function(t){console.log(t)}))}(y.value,v.value).then((function(t){S.textContent=t.name,b.textContent=t.about,a(_)})).catch((function(t){console.log(t)})).finally((function(){d(!1,g)}))}));var q=document.querySelector(".profile__add-button"),k=document.querySelector(".popup_type_new-card"),E=document.forms["new-place"],C=E.querySelector(".popup__input_type_card-name"),L=E.querySelector(".popup__input_type_url"),j=E.querySelector(".button");q.addEventListener("click",(function(){l(k,U),c(k),E.reset()})),E.addEventListener("submit",(function(e){var c,i;e.preventDefault(),d(!0,j),(c=C.value,i=L.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:c,link:i})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то не так: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){var e=t.owner._id;f.prepend(n(t,e,w,o,r)),a(k)})).catch((function(t){console.log(t)})).finally((function(){d(!1,j)}))}));var x=document.querySelector(".popup_type_image"),A=document.querySelector(".popup__image"),P=document.querySelector(".popup__caption");function w(t){A.src=t.target.src,A.alt=t.target.alt,P.textContent=t.target.alt,c(x)}var U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);s(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),s(n,o,e)}))}))}(e,t)}))}(U);var T=document.querySelector(".profile__image_section"),B=document.querySelector(".popup_type_avatar"),O=document.querySelector(".popup__input_type_avatar"),I=document.forms["edit-avatar"],D=I.querySelector(".button"),N=T.querySelector(".profile__image");T.addEventListener("click",(function(){l(I,U),c(B),I.reset()})),I.addEventListener("submit",(function(e){var n;e.preventDefault(),d(!0,D),(n=O.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то не так: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){N.src=t.avatarInput,a(B)})).catch((function(t){console.log(t)})).finally((function(){d(!1,D)}))}))})();